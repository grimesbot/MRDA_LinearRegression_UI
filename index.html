<!DOCTYPE html>
<html lang="en" data-bs-theme>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        
        <title>MRDA Rankings Algorithm using Linear Regression</title>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/2.3.5/css/dataTables.bootstrap5.min.css" />
        <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.5/css/buttons.bootstrap5.min.css" />        
        <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/4.0.5/css/fixedHeader.bootstrap5.min.css" />
        <link rel="stylesheet" href="https://cdn.datatables.net/rowgroup/1.6.0/css/rowGroup.bootstrap5.min.css" />
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg sticky-top bg-light">
            <div class="container-xl d-flex flex-row align-items-center justify-content-center">
                <a class="navbar-brand" href="#">
                    <img src="https://central.mrda.org/assets/img/logo-full-large.png" alt="MRDA Logo" height="40" class="d-inline-block">
                    Differentials Algorithm
                    <span class="betaFlag">BETA</span>
                </a>
                <div class="me-2 form-floating">
                    <select class="form-select" name="date" id="date" aria-label="Rankings Date"></select>
                    <label for="date">Date</label>
                </div>
                <div class="me-2 form-floating">
                    <select class="form-select" name="region" id="region" aria-label="Region">
                        <option value="GUR" selected>Global</option>                                                
                        <option value="AM">Americas</option>
                        <option value="EUR">Europe</option>
                    </select>
                    <label for="region" class="col-form-label">Region</label>
                </div>
                <button class="navbar-toggler me-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarToggler">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#upcomingGamesModal">Upcoming Games</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#predictorModal">Predictor</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#gamesModal">All Scores</a>
                        </li>
                        <li class="nav-item onlyCollapsed">
                            <a class="nav-link" href="https://mrda.org/rankings/">Official MRDA Rankings <i class="bi bi-box-arrow-up-right"></i></a>                
                        </li>
                        <li class="nav-item onlyCollapsed">
                            <a class="nav-link" href="https://github.com/grimesbot/MRDA_LinearRegression_UI/blob/main/README.md">Documentation <i class="bi bi-box-arrow-up-right"></i></a> 
                        </li>
                        <li class="nav-item onlyCollapsed">
                            <a class="nav-link" href="https://github.com/grimesbot/MRDA_LinearRegression_UI/">Source Code <i class="bi bi-box-arrow-up-right"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div id="rankingsChartContainer" class="container-xl" >
            <canvas id="rankingsChart"></canvas>
        </div>

        <div id="postseasonLegend" class="container-xl text-center">
            <div class="d-inline-block">Potential Postseason Tournament Invites:</div>
            <div class="postseasonPosition-GUR d-inline-block" data-toggle="tooltip" title="The top 7 ranked teams globally will receive a bye to MRDA Championships.">
                MRDA Championships
            </div>
            <div class="postseasonPosition-EUR d-inline-block">
                European 
                <span class="qualifiers" data-toggle="tooltip" data-bs-html="true" title="The top ranked European teams who did not receive a bye to MRDA Championships, up to 8, will receive an invite to MRDA European Qualifiers. The top 2 placing teams will receive invitations to MRDA Championships. <br><br> In the event European Qualifiers are not held, the next 2 highest ranked eligible European teams will receive an invite to MRDA Championships.">Qualifiers</span>
                <span class="invites" data-toggle="tooltip" data-bs-html="true" title="In the event European Qualifiers are not held, the next 2 highest ranked eligible European teams will receive an invite to MRDA Championships.<br><br>If there are no more eligible European teams, the next eligible team(s) from any region will be invited.">Champs Invites</span>
            </div>
            <div class="postseasonPosition-AA d-inline-block">
                Australasian 
                <span class="qualifiers" data-toggle="tooltip" data-bs-html="true" title="The top ranked Australasian teams who did not receive a bye to MRDA Championships, up to 8, will receive an invite to MRDA Australasian Qualifiers. The winning team will receive invitations to MRDA Championships. <br><br> In the event Australasian Qualifiers are not held, the next highest ranked eligible Australasian team will receive an invite to MRDA Championships.">Qualifiers</span>
                <span class="invites" data-toggle="tooltip" data-bs-html="true" title="In the event Australasian Qualifiers are not held, the next highest ranked eligible Australasian team will receive an invite to MRDA Championships.<br><br>If there are no eligible Australasian teams, the next eligible team from any region will be invited.">Champs Invite</span>
            </div>
            <div class="postseasonPosition-AM d-inline-block">
                Americas
                <span class="qualifiers" data-toggle="tooltip" data-bs-html="true" title="The top ranked teams from the Americas who did not receive a bye to MRDA Championships, up to 8, will receive an invite to MRDA Americas Qualifiers. The top 2 placing teams will receive invitations to MRDA Championships. <br><br> In the event Americas Qualifiers are not held, the next 2 highest ranked eligible teams from the Americas will receive an invite to MRDA Championships.">Qualifiers</span>
                <span class="invites" data-toggle="tooltip" data-bs-html="true" title="In the event Americas Qualifiers are not held, the next 2 highest ranked eligible teams from the Americas will receive an invite to MRDA Championships.<br><br>If there are no more eligible teams from the Americas, the next eligible team(s) from any region will be invited.">Champs Invites</span></div>
        </div>
        
        <main id="mrdaRankingPointsContainer" role="main" class="container-xl table-responsive" >
            <table id="mrdaRankingPoints" class="table table-striped" width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th data-toggle="tooltip" class="noIcon" title="Change in rank from last quarter."><i class="bi bi-triangle" style="font-size: .75em;"></i></th>                        
                        <th colspan="2">Team</th>
                        <th data-toggle="tooltip" class="noWrap" title="Ranking Points. The difference between the Ranking Points of two teams indicates the predicted score differential of a game played by those two teams.">RP</th>
                        <th data-toggle="tooltip" class="noWrap" title="Standard Error. Higher error indicates uncertainty, such as inconsistent performance or newer teams who've played fewer games.">SE</th>
                        <th data-toggle="tooltip" class="noIcon" data-bs-html="true" title="Sanctioned Games Played in the Ranking Period for compliance:<br>3+ to be Ranked<br>5+ to be Postseason Eligible">GP</th>
                        <th data-toggle="tooltip" class="noIcon" title="Wins">W</th>
                        <th data-toggle="tooltip" class="noIcon" title="Losses">L</th>
                        <th data-toggle="tooltip" class="noIcon" title="Display team's Ranking Point history in line chart above."><i class="bi bi-graph-up"></i></th>
                    </tr>
                </thead>
            </table>
            <div style="font-size:.85rem; margin-top:.5rem;">
                Last refreshed at <span id="rankingsGeneratedDt"></span>.
                <a href="https://github.com/grimesbot/MRDA_LinearRegression_UI/blob/main/README.md">Documentation</a> 
                <a href="https://github.com/grimesbot/MRDA_LinearRegression_UI/">Source Code</a>
                <a href="https://mrda.org/rankings/">Official MRDA Rankings</a>
                <a href="#" data-bs-toggle="modal" data-bs-target="#maleModal">Mean Absolute Log Error</a>
            </div>
        </main>

        <div id="teamDetailModal" class="modal fade" tabindex="-1" aria-labelledby="teamDetailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-fullscreen-xl-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <img id="teamLogo" class="me-2" src="" height="70">
                        <div>
                            <h3 class="modal-title" id="teamDetailModalLabel"><span id="teamName"></span></h3>
                            <h5 id="teamLocation"></h5>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h5 class="text-center">Current Ranking Points: <span style="font-weight: bold;" id="teamAverageRankingPoints"></span></h5>
                        <div id="teamChartContainer">
                            <canvas id="teamChart"></canvas>
                        </div>
                        <table id="teamGameHistory" class="table table-striped" width="100%">
                            <thead>
                                <tr class="dtrg-group dtrg-level-0">
                                    <th colspan="5">Game History</th>
                                    <th colspan="4" class="rpBeforeAfter" data-toggle="tooltip" title="Ranking Points from the Wednesday before and after the game(s)">RP: Before <i class='bi bi-arrow-right'></i> After</th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th>Score</th>
                                    <th data-toggle="tooltip" title="Actual score differential">Diff</th>
                                    <th data-toggle="tooltip" title="Expected score differential as of game date">Exp</th>
                                    <th data-toggle="tooltip" title="Game weight for least weighted squares linear regression algorithm. Weights diminish for games with score differential beyond 200">Wt</th>
                                </tr>
                            </thead>
                        </table>
                        <div class="text-center">
                            <button type="button" id="loadOlderGames" class="btn btn-outline-primary mt-3">Show games from previous ranking period</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="modal fade" id="gamesModal" tabindex="-1" aria-labelledby="gamesModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-fullscreen-xl-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="gamesModalLabel">All score data used in current rankings calculation</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table id="apiGames" class="table table-striped" width="100%">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th class="dt-right">Home Team</th>
                                        <th></th>
                                        <th class="dt-center">Score</th>
                                        <th></th>
                                        <th>Away Team</th>
                                        <th class="dt-center">Weight</th>
                                    </tr>
                                </thead>
                            </table>
                            <div style="font-size:.85rem;">
                                <sup>†</sup>Scores not yet validated
                            </div>
                            <div style="font-size:.85rem;">
                                <sup>↓</sup>Forfeit
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>  

        <div class="modal fade" id="upcomingGamesModal" tabindex="-1" aria-labelledby="upcomingGamesModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-fullscreen-xl-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="upcomingGamesModal">Upcoming Games & Scores Not Yet Reported</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table id="upcomingGames" class="table table-striped" width="100%">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th class="dt-right">Home Team<div class='teamRp'>Ranking Points</div></th>
                                        <th></th>
                                        <th class="dt-center">Predicted Differential</th>
                                        <th></th>
                                        <th>Away Team<div class='teamRp'>Ranking Points</div></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>  

        <div class="modal fade" id="predictorModal" tabindex="-1" aria-labelledby="predictorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-fullscreen-xl-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="predictorModalLabel">Expected Score Differential Calculator</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex flex-row align-items-center justify-content-center">
                            <div class="p-2 form-floating">
                                <select id="homeTeam" class="form-select" aria-label="Home Team"><option disabled selected value></option></select>
                                <label for="homeTeam">Home Team</label>
                            </div>
                            <div class="p-2 form-floating">
                                <input id="gameDate" class="form-control" type="date" aria-label="Game Date" />
                                <label for="gameDate">Game Date</label>
                            </div>
                            <div class="p-2 form-floating">
                                <select id="awayTeam" class="form-select" aria-label="Away Team"><option disabled selected value></option></select>
                                <label for="awayTeam">Away Team</label>
                            </div>
                        </div>
                        <div class="d-flex flex-row align-items-center justify-content-center">
                            <div class="p-2 text-end">
                                <label for="homeRankingPoints" style="font-weight: bold;">Ranking Points</label>
                                <div id="homeRankingPoints">&nbsp;</div>
                            </div>
                            <div class="p-2">
                                <img id="predictorHomeTeamLogo" height="150" src="team-logos\MRDA-Logo-Acronym.png" >
                            </div>
                            <div class="p-2 text-center">
                                <label for="expectedScoreDiff" style="font-weight: bold;">Expected Score Differential</label>
                                <div id="expectedScoreDiff">&nbsp;</div>
                            </div>
                            <div class="p-2">
                                <img id="predictorAwayTeamLogo" height="150" src="team-logos\MRDA-Logo-Acronym.png" >
                            </div>
                            <div class="p-2">
                                <label for="awayRankingPoints" style="font-weight: bold;">Ranking Points</label>
                                <div id="awayRankingPoints">&nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="maleModal" tabindex="-1" aria-labelledby="maleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-fullscreen-xl-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="maleModalLabel">Mean Absolute Log Error</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table id="errorSummary" class="table table-striped" width="100%">
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>      

        <script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.datatables.net/2.3.5/js/dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/2.3.5/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/3.2.5/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.html5.min.js"></script>        
        <script src="https://cdn.datatables.net/fixedheader/4.0.5/js/dataTables.fixedHeader.min.js"></script>
        <script src="https://cdn.datatables.net/rowgroup/1.6.0/js/dataTables.rowGroup.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/moment"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-error-bars/build/index.umd.min.js"></script>

        <script src="mrda_events.js"></script>
        <script src="mrda_teams.js"></script>
        <script src="mrda_games.js"></script>    
        <script src="mrda_rankings_history.js"></script>
        <script src="mrdaLinearRegressionSystem.js"></script>
        <script src="main.js"></script>
    </body>
</html>